{% extends "base.njk" %}

{% block pagetitle %} Fármacos {% endblock %}

{% block content %}

    {# {% include "layouts/content_header.njk"%} #}

    {# BLOQUE DE TABLA #}
    <div id="" class="mt-4 table-responsive">

        <div class="d-flex justify-content-between mb-2">
            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalAgregar">Agregar Fármaco <i class="fa-solid fa-plus"></i>
            </button>
            <input type="text" id="searchBox" class="search-box form-control form-control-sm" placeholder="Buscar farmaco por nombre"/>
        </div>
        <div id="drugsTable" class="border mt-3">
            {# TABLA DINAMICA #}
        </div>
    </div>

    {# MODAL AGREGAR #}
    <div class="modal fade" id="modalAgregar" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalAgregarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="modalAgregarLabel">Agregar nuevo fármaco</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="my-2">Los campos con <span class="text-danger">*</span> son obligatorios</p>
          <form id="formRegistrar" class="row g-3">
            <div class="col-md-6">
              <label for="" class="form-label">Nombre<span class="text-danger">*</span></label>
              <input type="text" name="name" class="form-control form-control-sm" id="">
            </div>
            <div class="col-md-6">
              <label for="" class="form-label">Genérico <span class="text-danger">*</span></label>
              <input type="text" name="lastname" class="form-control form-control-sm" id="">
            </div>
            <div class="col-12">
              <label for="" class="form-label">Descripción</label>
              <input type="text" name="cellphone" class="form-control form-control-sm" id="" placeholder="">
            </div>
            <div class="col-6">
              <label for="" class="form-label">Dosis</label>
              <input type="text" name="cellphone" class="form-control form-control-sm" id="" placeholder="">
            </div>
            <div class="col-6">
              <label for="" class="form-label">Período de tratamiento</label>
              <input type="text" name="cellphone" class="form-control form-control-sm" id="" placeholder="">
            </div>


            {# Este sera para grupo farmacologico #}
            <div class="col-md-6">
              <label for="inputState" class="form-label">Presentación <span class="text-danger">*</span></label>
              <select name="gender" id="inputState" class="form-select form-select-sm">
                <option selected>Seleccionar</option>
                <option value="M">Masculino</option>
                <option value="F">Femenino</option>
              </select>
            </div>
            {# Este sera para grupo farmacologico #}
            {# Este sera para presentacion #}
            <div class="col-md-6">
              <label for="inputState" class="form-label">Grupo Farmacológico <span class="text-danger">*</span></label>
              <select name="gender" id="inputState" class="form-select form-select-sm">
                <option selected>Seleccionar</option>
                <option value="M">Masculino</option>
                <option value="F">Femenino</option>
              </select>
            </div>
            {# Este sera para presentacion #}
            
            
            
            <div class="modal-footer d-flex justify-content-center">
              <button type="submit" class="btn btn-success btn-sm">Guardar</button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
    {# MODAL EDICION #}

{% endblock %}

{% block scripts %}
<script>
    const tableData = {{ drugs | dump | safe}}
    const tabla = new Tabulator("#drugsTable", {
      locale: "es-es",
      langs: LANG.langs,
      data: tableData,
      layout: "fitColumns",
      pagination: "local",
      paginationSize: 10,
      responsiveLayout: true,
      columns: [
        {
          title: "Nombre Comercial",
          field: "name"
        }, {
          title: "Nombre Genérico",
          field: "generic"
        }, {
          title: "Decripcion",
          field: "description"
        },
        {
          title: "Dosis",
          field: "dosage"
        }, 
        {
          title: "Período de tratamiento",
          field: "treatmentPeriod"
        },
        {
          title: "Acciones",
          formatter: (cell) => {
            const id = cell.getRow().getData().id
            return `
                        <a href="/evaluation/${id}" class="btn btn-primary btn-sm"><i class="fa-solid fa-file-waveform"></i></a>
                        <button class="btn btn-warning btn-sm editar" data-bs-toggle="modal" data-bs-target="#modalEditar"><i class="fa-solid fa-pen"></i></button>
                        <button class="btn btn-danger btn-sm"><i class="fa-solid fa-trash"></i></button>
                    `
          },
          width: 140,
          cellClick: (e, cell) => {
            const data = cell
              .getRow()
              .getData();

            fillModalForm(data);
            if (e.target.classList.contains("editar")) {
              console.log("Editar:", data);
            }

            if (e.target.classList.contains("eliminar")) {
              console.log("Eliminar:", data);
            }
          }
        }
      ]
    })

    document
      .getElementById("searchBox")
      .addEventListener("keyup", (e) => {
        tabla.setFilter("name", "like", e.target.value);
      });
  </script>
  <script src="/js/sweetAlertHelper.js"></script>
{% endblock %}

{# 
{% %} {% endblock %}
{% %} {% endblock %}
{% %} {% endblock %}
{% %} {% endblock %} #}