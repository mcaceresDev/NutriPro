{% extends "base.njk" %}

{% block pagetitle %} Usuarios {% endblock %}

{% block content %}

    <button class="btn btn-primary btn-sm" onclick="crearUsuario()">Crear Usuario de Prueba</button>

    <table border="1" id="tabla-usuarios" cellpadding="8">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Usuario</th>
                <th>Email</th>
                <th>Sexo</th>
            </tr>
        </thead>
        <tbody id="tbody-usuarios">
            <!-- Se llenará por AJAX -->
        </tbody>
    </table>

    <script>
    async function cargarUsuarios() {
        const res = await fetch("/users/all");
        const data = await res.json();

        const tbody = document.getElementById("tbody-usuarios");

        data.forEach(u => {
            tbody.innerHTML += `
                <tr>
                    <td>${u.id}</td>
                    <td>${u.name}</td>
                    <td>${u.lastname}</td>
                    <td>${u.username}</td>
                    <td>${u.email}</td>
                    <td>${u.gender}</td>
                </tr>
            `;
        });
    }


    async function crearUsuario() {
        const res = await fetch("/users/new-user", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                name: "Juan",
                lastname: "Pérez",
                username: "juanperez",
                email: "manuel.caceres@gmail.com",
                password: "securepassword",
                gender: "M"
            })
        });
        const data = await res.json();
        console.log("Nuevo usuario creado:", data);        
    }

    // Ejecuta la carga al abrir la página
    cargarUsuarios();
</script>

{% endblock %}
