Sintaxis Nunjucks

<!-- src/views/index.njk -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }}</title>
</head>
<body>
  <h1>Hola, {{ name }}!</h1>
</body>
</html>


CONDICIONALES
{% if usuario %}
  <p>Hola, {{ usuario }}!</p>
{% else %}
  <p>Bienvenido, visitante!</p>
{% endif %}

BUCLES
<ul>
  {% for item in items %}
    <li>{{ item }}</li>
  {% endfor %}
</ul>


FILTROS | PIPES
<p>{{ name | uppercase }}</p>  <!-- Imprime el nombre en mayúsculas -->
<p>{{ date | date("YYYY-MM-DD") }}</p>  <!-- Formatea una fecha -->

PARTIALS
<!-- src/views/index.njk -->
<html>
  <head><title>{{ title }}</title></head>
  <body>
    {% include "header.njk" %}
    <h1>Bienvenido a mi página</h1>
    {% include "footer.njk" %}
  </body>
</html>

PLANTILLAS
<!-- src/views/base.njk -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Título Predeterminado{% endblock %}</title>
</head>
<body>
  {% block content %}{% endblock %}
</body>
</html>

<!-- src/views/index.njk -->
{% extends "base.njk" %}

{% block title %}Página Principal{% endblock %}

{% block content %}
  <h1>Bienvenido a la página principal</h1>
{% endblock %}

MACROS
Los macros en Nunjucks son similares a las funciones y te permiten crear bloques reutilizables de código. Son muy útiles cuando necesitas renderizar un patrón repetido.

{% macro renderUsuario(usuario) %}
  <div class="usuario">
    <h2>{{ usuario.nombre }}</h2>
    <p>{{ usuario.email }}</p>
  </div>
{% endmacro %}

<!-- Luego lo usas en la plantilla -->
{{ renderUsuario(usuario) }}

EXTRUCTURA DE PROYECTO
/mi-proyecto
  /node_modules
  /src
    /views
      index.njk      <-- Plantilla principal
      header.njk     <-- Header compartido
      footer.njk     <-- Footer compartido
      base.njk       <-- Plantilla base para herencia
    /public
      /styles
        styles.css
  package.json
  tsconfig.json
  index.ts

======================================================================

-- Crear base de datos
CREATE DATABASE nutri_interacciones;
USE nutri_interacciones;

-- Tabla de medicamentos
CREATE TABLE medicamentos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    generico VARCHAR(100) NOT NULL,
    grupo_farmacologico VARCHAR(100),
    descripcion TEXT
);

-- Tabla de nutrientes o alimentos
CREATE TABLE nutrientes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    tipo ENUM('nutriente', 'alimento') DEFAULT 'nutriente',
    categoria VARCHAR(100),
    descripcion TEXT
);

-- Tabla de enfermedades (opcional, pero útil para relacionar casos como diabetes o dislipidemia)
CREATE TABLE enfermedades (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT
);

-- Tabla de interacciones
CREATE TABLE interacciones (
    id INT AUTO_INCREMENT PRIMARY KEY,
    medicamento_id INT NOT NULL,
    nutriente_id INT NOT NULL,
    enfermedad_id INT NULL,
    tipo ENUM('positiva', 'negativa') NOT NULL,
    efecto TEXT NOT NULL,
    recomendacion TEXT,
    nivel_evidencia ENUM('alta', 'media', 'baja') DEFAULT 'media',
    FOREIGN KEY (medicamento_id) REFERENCES medicamentos(id),
    FOREIGN KEY (nutriente_id) REFERENCES nutrientes(id),
    FOREIGN KEY (enfermedad_id) REFERENCES enfermedades(id)
);

====================================================================
Agua
Energía
Proteina
Grasa Total
Carbohidratos
Fibra Diet. total
Ceniza
Calcio
Fosforo
Hierro
Tiamina
Riboflavina
Niacina
Vit. C
Vit. A Equiv. Retinol
Ác. grasos mono-insat.
Ác. grasos poli-insat.
Ác. Grasos saturados
Colesterol
Potasio
Sodio
Zinc
Magnesio
Vit. B6
Vit. B12
Ac. Fólico
Folato Equiv. FD
Fracción Comestible

=================================================================================
EJEMPLO DE USO DE TABULATOR
=================================================================================
  <script>
    const opciones={ weekday: 'long' , year: 'numeric' , month: 'short' , day: 'numeric' };
      const data = JSON.parse('<%- JSON.stringify(prefixes) %>')
      const tabla = new Tabulator("#prefixTable", {
      locale: "es-es",
      langs: LANG.langs,
      data: data,
      layout: "fitColumns",
      pagination: "local",
      paginationSize: 10,
      responsiveLayout: "collapse",
      columns: [
        { title: "ID", field: "id", visible: false },
        { title: "Prefijo", field: "initialNumber", sorter: "string" },
        { title: "Proveedor", field: "Provider.name", sorter: "string" },
        { title: "Creado en", field: `createdAt`, formatter: function(cell) {
            const fecha = new Date(cell.getValue());
            return fecha.toLocaleDateString('es-ES', opciones);
          }},
        { title: "Actualizado en", field: "updatedAt", formatter: function(cell) {
            if (!cell.getValue()) {
              return ""
            }
            else{
              const fecha = new Date(cell.getValue());
              return fecha.toLocaleDateString('es-ES', opciones);
            } 
          }},
        {
          title: "Acciones", headerHozAlign: "center", hozAlign: "center", formatter: function(cell, formatterParams) {
            const id = cell.getRow().getData().id;
            const prefix = cell.getRow().getData().initialNumber;
            const providerId = cell.getRow().getData().providerId;
            return `
              <button class="btn btn-sm btn-primary me-1" onclick="abrirEditar(${id}, ${prefix}, ${providerId})">Editar</button>
              <button class="btn btn-sm btn-danger" onclick="abrirBorrar(${id}, ${prefix})">Eliminar</button>
            `;
          }
        }
      ],
    });

    // tabla.setData(datos); //Para actualizar los datos en la tabla
    document.getElementById("buscar").addEventListener("input", function () {
      tabla.setFilter("initialNumber", "like", this.value);
    });
  </script>

  ============================================================================
  EJEMPLO DE CRUD
  ============================================================================
  const alertType = {
  success: "success",
  info: "info",
  warning: "warning",
  error: "error"
}
const sendFeedBack= (message, alertType)=> {
  const Toast = Swal.mixin({
    toast: true,
    position: "top-end",
    showConfirmButton: false,
    timer: 2000,
    timerProgressBar: true,
    didOpen: (toast) => {
      toast.onmouseenter = Swal.stopTimer;
      toast.onmouseleave = Swal.resumeTimer;
    }
  });

  return Toast.fire({
    icon: alertType ? alertType : "success",
    title: message ? message : ""
  });
}

//Funcion de llamado de datos
  const getPrefixes = async()=>{
    try {
        const res = await fetch(`/admin-api/prefixes-only`, {
          method: "GET"
        });
        const data = await res.json();
  
        if (res.ok) {
          //Hace referencia a la tabla cargada con tabulator y la actualiza
          tabla.setData(data.rows)
          
        } else {
          sendFeedBack(data.message,alertType.error)
        }
      } catch (err) {
        bootstrap.Modal.getInstance(document.getElementById("modalRegistro")).hide();
        sendFeedBack(err.message,alertType.error)
      }
  }
  
  // Este código evita que el formulario recargue la página
  document.getElementById("formRegistrar").addEventListener("submit", async function (e) {
      e.preventDefault();
      const initialNumber = document.getElementById("prefix").value;
      const providerId = document.getElementById("providerId").value;
  
      try {
        const res = await fetch(`/admin-api/prefix/new`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ initialNumber, providerId })
        });
        const data = await res.json();
  
        if (res.ok) {
          // Cierra el modal y recarga la tabla
          bootstrap.Modal.getInstance(document.getElementById("modalRegistro")).hide();
          sendFeedBack(data.message, alertType.success)
          getPrefixes()
        } else {
          bootstrap.Modal.getInstance(document.getElementById("modalRegistro")).hide();
          sendFeedBack(data.message, alertType.error)
        }
      } catch (err) {
        console.log(err);
        
        bootstrap.Modal.getInstance(document.getElementById("modalRegistro")).hide();
        sendFeedBack(err.message, alertType.error)
      }
    });


// Funcion para editar info
document.getElementById("formEditar").addEventListener("submit", async function (e) {
  e.preventDefault();

  const id = document.getElementById("editId").value;
  const initialNumber = document.getElementById("editPrefix").value;
  const providerId = document.getElementById("editProvider").value;

  try {
    const res = await fetch(`/admin-api/prefix-edit/${id}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ initialNumber, providerId })
    });
    const data = await res.json();
    
    if (res.ok) {
      // Cierra el modal y recarga la tabla
      bootstrap.Modal.getInstance(document.getElementById("modalEditar")).hide();
      sendFeedBack(data.message, alertType.success)
      getPrefixes()
      
    } else {
      bootstrap.Modal.getInstance(document.getElementById("modalEditar")).hide();
      sendFeedBack(data.message, alertType.error)
    }
  } catch (err) {
    bootstrap.Modal.getInstance(document.getElementById("modalEditar")).hide();
    sendFeedBack(err.message, alertType.error)
  }
});

// Funcion para Borrar
document.getElementById("formBorrar").addEventListener("submit", async function (e) {
  e.preventDefault();

  const id = document.getElementById("delId").dataset.deleteid;
  
  try {
    const res = await fetch(`/admin-api/prefix-del/${id}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      }
    });
    const data = await res.json();
    
    if (res.ok) {
      // Cierra el modal y recarga la tabla
      bootstrap.Modal.getInstance(document.getElementById("modalBorrar")).hide();
      sendFeedBack(data.message, alertType.success)
      getPrefixes()
      
    } else {
      bootstrap.Modal.getInstance(document.getElementById("modalBorrar")).hide();
      sendFeedBack(data.message, alertType.error)
    }
  } catch (err) {
    console.log(err);
    bootstrap.Modal.getInstance(document.getElementById("modalBorrar")).hide();
    sendFeedBack(err.message, alertType.error)
  }
});